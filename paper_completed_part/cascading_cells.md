### **3.3 돌출 셀 제거 알고리즘**

그리드 기반의 배치 방식으로 생성된 건축 평면은, 병렬 확장 알고리즘을 적용하더라도 **돌출 셀**의 발생을 완전히 방지할 수 없다. 시드 셀 간의 근접성 또는 동일 방향 확장이 충돌을 야기할 경우, 고립된 위치에 작은 셀들이 남아 방의 형태를 불규칙하게 만들기 때문이다. 이러한 배치는 공간적 비효율성을 초래하고, 평면도의 미적 일관성을 저해할 수 있다. 이를 해결하기 위해 돌출 셀을 식별하고 교환하는 절차를 도입하였다.

#### **3.3.1 돌출 셀 식별**

설계 공간의 모든 셀을 순차적으로 탐색하여 돌출 셀을 식별한다. 돌출 셀은 같은 공간에 속하지 않은 셀과 지나치게 많이 인접한 셀로 정의할 수 있다.  설계 공간 $F$의 모든 셀 $c$에 대해, 그 셀이 3개 이상의 유효하지 않은 셀 또는 다른 방에 속한 셀과 인접해 있다면 해당 셀을 돌출 셀로 간주한다.

$$
P(c) = 
\begin{cases}
1, & \text{if } V(c) \text{ and } N_{\text{diff}}(c) \geq 3 \\
0, & \text{otherwise}
\end{cases}
$$

여기서:
- $P(c)$는 셀 $c$가 돌출(protruding) 셀인지 여부를 나타내며, 1이면 돌출 셀이다.
- $V(c)$는 셀 $c$가 유효(valid)한지 여부를 나타내는 함수로, 셀이 그리드 경계 내에 있고, 방 번호가 할당된 경우에 $V(c) = 1$이다.
- $N_{\text{diff}}(c)$는 셀 $c$의 인접한 셀 중 유효하지 않거나 다른 방에 속한 셀의 개수를 의미한다.

#### **3.3.2 돌출 셀 교환 알고리즘**

식별된 돌출 셀을 제거하는 과정은 다음과 같이 진행된다. 돌출 셀의 인접 셀 중에서 같은 방에 속하지 않은 셀을 골라 교환 가능한지 검사한다.   교환이 가능하려면 다음  조건을 만족해야 한다. 
1. **유효성 유지**: 교환 후의 방이 공간의 일관성을 유지할 수 있도록 교환 이후의 모든 셀은 **유효한 상태**를 유지해야 한다. 
2. 교환 기록 추적: 교착 상태를 회피하기 위해, 같은 위치의 교환이 반복해서 일어나지 않도록 교환 기록을 추적해야 한다. 

**유효한 교환의 조건**은 셀 교환 후에도 교환된 셀이 적어도 하나 이상의 인접 셀과 동일한 방으로 연결되어 있어야 한다. 더불어, 교환된 셀과 인접한 모든 셀 역시 교환으로 인해 방의 **연속적인 공간적 연결성**이 훼손되지 않아야 한다.

교환 기록을 추적하는 방식은 교환이 발생한 셀과 방의 쌍을 기록하여 이전에 시도된 방은 교환 후보에서 제외하는 것이다.  이를 통해 동일한 시도를 번갈아 반복하는 교착 상태를 피하고, 교환할 수 있는 새로운 교환 후보를 지속적으로 탐색할 수 있다. 

1. **돌출 셀 식별**: 이는 인접한 셀 중 유효하지 않거나 다른 방에 속한 셀과 3개 이상 인접한 경우로 정의된다.
2. **교환 후보 탐색**: 돌출 셀과 인접한 셀 중 다른 방에 속한 셀을 교환 후보로 탐색한다. 히스토리 관리 기법을 통해 이미 교환된 방과의 중복 시도를 방지한다.
3. **교환 및 유효성 검사**: 돌출 셀과 교환이 이루어지면, 교환된 셀과 그 인접 셀들이 유효한 상태인지 검사한다. 유효하지 않으면 원래 상태로 되돌리고, 다른 교환 후보를 탐색한다.
4. **반복**: 모든 돌출 셀이 제거될 때까지 과정을 반복한다.

