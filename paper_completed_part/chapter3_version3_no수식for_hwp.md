
### **3.1 초기 위치 설정**

건축 평면을 생성하기 위한 설계 공간 G_footprint는 m x n 크기의 격자로 구성된 2차원 공간으로, 내부 공간을 정의하는 배열로 표현된다.
$$G_{footprint} = \{(i, j) \mid g_{ij} = 1\}\tag{1}$$

설계 공간 내 모든 셀을 방에 할당하는 과정은 평면 배치의 기본이다. 각 셀은 설계 공간의 최소 단위로, 사용자 정의 크기를 갖는다. (이 연구에서는 셀의 크기를 1m로 설정하였다.) 각 방은 특정 시드 셀에서 시작해 인접 셀로 확장된다. 시드 셀의 위치를 설정하는 방식은 다음과 같다.

**1. 각 방의 시드 셀 결정**: 설계 공간 G_footprint에서 k개의 시드 셀 s_i를 무작위로 선택한다.
$$
s_i = (x, y) \quad \text{where} \quad G_{x,y} = 1 \quad \text{and} \quad i = 1, 2, \dots, k
$$
시드 셀 집합 S는 각 방의 시작 위치를 나타내며, 초기에는 방 번호가 할당되지 않은 상태로 특정 값(255)으로 표시된다.

**2. 방 번호 할당**: 시드 셀 s_i에 고유한 방 번호 i를 할당하여 초기 설계 공간 G_init을 구성한다.
$$
G_{\text{init}}(x, y) =
\begin{cases}
i, & \text{if } (x, y) = s_i \quad \text{for} \quad s_i \in S \\
0, & \text{if } (x, y) \in G_{\text{footprint}} \setminus S \\
-1, & \text{if } (x, y) \notin G_{\text{footprint}}
\end{cases}
\tag{2}
$$

여기서:
- G_footprint는 내부 공간을 나타내는 영역이며, 시드 셀 s_i는 방 번호 i를 할당받는다.
- 값이 0인 셀은 아직 방 번호가 할당되지 않은 셀을 의미하며, 내부 공간이 아닌 셀은 -1로 마스킹된다.

방 번호가 할당된 시드 셀은 이후 방 배치의 중요한 출발점이 되며, 시드 셀의 위치에 따라 최종 방 배치가 달라진다. 본 연구에서는 초기 시드 셀을 할당하는 세 가지 방식을 제안한다: 방향 최적화, 인접성 최적화, 무작위 배치.

#### **3.1.1 방향 최적화를 통한 시드 셀 할당**

방향 최적화는 방이 특정 방향(동, 서, 남, 북)으로 배치되어야 한다는 요구를 반영하여 시드 셀을 할당하는 방법이다. 방향 요구사항은 방 r_i와 요구되는 방향 o_i의 쌍으로 구성된 목록으로 표현되며, 다음과 같이 정의된다:
$$O = \{(r_i, o_i) \mid r_i \in R, o_i \in \text{ \{East, West, South, North\} }\}\tag{3}$$

방 r_i의 시드 셀 s_i는 해당 방 r_i가 요구된 방향 o_i에 배치되기에 가장 유리한 위치에 할당된다. 방 r_i의 시드 셀 s_i는 방 r_i가 요구된 방향 o_i에 배치되기에 가장 유리한 위치에 할당된다. 이때 유리한 위치란, 시드 셀이 설계 공간의 경계면에서 요구된 방향 o_i에 가장 가까운 위치를 의미한다.  모든 시드 셀의 위치는 좌표 x, y를 기준으로 정렬되어 동서남북 네 방향의 방향 스코어 리스트 Sc_o가 생성된다.  방 i의 시드 셀 s_i는 방 r_i가 향하고 있어야 하는 방향 o_i의 스코어 리스트에서 가장 높은 값을 갖는 셀로 선택된다. 이는 다음과 같이 나타낼 수 있다. 
$$s_i = \arg\max_{s_i} Sc_o(O_i)\tag{4}$$
이 때 스코어 Sc_o는 시드 셀이 설계 공간에서 해당 방향(o_i)의 경계면으로부터 얼마나 가까운지를 나타낸다.

#### **3.1.2 인접성 향상을 위한 시드 셀 할당**

인접성 최적화는 인접해야 하는 두 방의 시드 셀을 가능한 한 가까이 배치함으로써 방들 간의 인접성을 향상시키는 전략이다. 인접성은 방들 간의 관계를 나타내는 이항 관계로 정의되며, 인접성 요구사항은 방 r_i와 인접해야 하는 방 r_j의 인덱스 쌍 (r_i, r_j) 의 집합으로 표현된다. 
$$
Adj = \{(r_i, r_j) \mid r_i, r_j \in R, r_i \text{ and } r_j \text{ must be adjacent}\}\tag{5}
$$

인접성 최적화의 목표는 시드 셀 s_i가 미할당 시드 셀 중에서 방 r_j의 시드 셀 s_j와 가장 가까운 위치를 선택하는 것이다. 이를 통해 방 r_i와 방 r_j가 인접하게 배치될 가능성을 극대화한다. 이 과정은 다음과 같은 수식으로 표현된다:
$$
s_i = \arg\min_{s_j \in \text{unassigned}} d_{i,j} \quad \text{where} \quad (r_i, r_j) \in Adj\tag{6}
$$
여기서 d_{i,j}는 방 r_i와 방 r_j 사이의 맨해튼 거리를 나타내며, 이는 두 시드 셀 간의 직교 좌표계에서의 이동 거리를 의미한다. 인접성 최적화는 이러한 방식으로 방들 간의 물리적 인접성을 고려하여 시드 셀을 배치한다.

#### **3.1.3 무작위 배치**

선택적으로 방향이나 인접성 요구를 생략하거나, 요구 사항이 없는 경우, 시드 셀은 무작위로 방 번호가 할당된다. 방향 및 인접성 최적화 시드 셀 할당이 진행된 후에도 미할당 시드셀이 존재할 수 있으며, 이러한 미할당 시드 셀은 임의의 방 번호로 설정되며, 이를 통해 초기 배치가 완료된다.

### **3.2 평면도 생성 과정**

#### **3.2.1 평면도 생성 알고리즘 개요**

건축 평면의 배치 알고리즘은 시드 셀이 할당된 초기 상태의 그리드 G_init을 입력받아, 시드 셀을 확장하여 각 방의 형태를 형성하고 최종 평면도를 완성한다. 알고리즘의 목표는 다음 조건을 충족하는 평면도를 생성하는 것이다.

1. **모든 방에 최소 공간 할당**: 각 방은 최소한 하나의 셀을 할당받는다.
2. **방 분할 방지**: 방이 하나의 연속적인 공간으로 유지되어야 하며, 겹치거나 분리되지 않는다.
3. **빈 공간 제거**: 모든 유효 셀은 방에 할당되며, 빈 공간을 남기지 않는다.
4. **설계 공간 내에서 배치**: 방이 설계 공간을 넘지 않는다.
5. **최대 면적 제한 준수**: 평면도 생성 과정 중 방의 크기 제약 조건을 반영하여 최대 면적 요구 사항을 초과하지 않는다.

이 과정에서 평면도가 완성되면, 초기 설계 공간 G_init의 모든 유효 셀(즉, 내부 공간을 나타내는 셀)에 방 번호가 할당된 상태로 최종적으로 결정된다. 이를 새로운 평면도 그리드 F로 정의한다.

#### **3.2.2 경계 셀 확장 방식**

방의 배치는 경계 셀 중 하나를 선택하고, 그에 인접한 셀을 확장하는 방식으로 이루어진다. 선택된 셀의 방향에 따라 평행한 인접 셀들도 함께 확장된다. 이러한 방식은 방의 형태가 불규칙하게 형성되는 것을 방지하고, 방의 외곽이 일관된 형태를 유지하도록 한다.

$$b_i = \text{Random}(B(r_i))$$

여기서 b_i는 방 r_i의 경계에 위치한 무작위로 선택된 셀이다. 방의 경계는 하나 이상의 미할당 셀(즉, 값이 0인 셀)을 인접 셀로 가진 셀들로 정의된다. 선택된 경계 셀 b_i에 인접한 빈 셀

빈 셀들의 집합을 adj(b_i)로 정의하며, 그 중 하나를 무작위로 선택하여 방 r_i에 새로 할당한다.

$$s_{\text{new}} = \text{Random}(adj(b_i))$$

여기서 s_new는 경계 셀 b_i에 인접한 빈 셀들 중 무작위로 선택된 셀이며, 이 셀은 방 r_i의 일부로 새롭게 할당된다.

**병렬 확장**은 선택된 셀 b_i와 s_new의 가로 또는 세로 방향에 따라 해당 방향으로 평행하게 확장 가능한 인접 셀들까지 동시에 확장하는 방식이다. 이 확장을 통해 방이 한쪽 방향으로 균형 있게 확장되며, 불규칙한 형태의 발생을 방지한다.

$$P_{\text{parallel}} = \{s' \mid s' = (x' + dx, y' + dy), s' \in B(r_i), \text{unassigned cell}\}$$

여기서 P_parallel은 방 r_i의 경계에서 선택된 셀들과 같은 방향으로 확장 가능한 빈 셀들의 집합을 의미한다. 모든 P_parallel에 포함된 셀은 방 r_i로 새롭게 할당된다.

방의 경계가 확장된 후, 기존 경계 셀 집합 B(r_i) 중 확장이 완료된 셀은 경계 셀 목록에서 제거되며, 새로 확장된 셀들이 경계 셀 목록에 추가된다. 이 경계 셀 목록은 이후 확장 과정에서 반복적으로 사용되며, 방이 더 이상 확장할 수 없는 상태에 도달할 때까지 갱신된다.

경계 셀 목록의 갱신 과정은 다음과 같이 표현된다. 새로 확장된 셀 s_new와 병렬로 확장된 셀들 P_parallel은 경계 셀 목록에 추가되며, 확장이 완료된 기존 셀들은 목록에서 제거된다.

$$B(r_i) \leftarrow \left(B(r_i) \setminus b_i \right) \cup \{ s_{\text{new}} \} \cup P_{\text{parallel}}$$

이 병렬 확장 과정은 한 번의 반복 동안 모든 방에 대해 수행되며, 경계 셀 목록은 각 반복을 통해 지속적으로 갱신된다. 이를 통해 방의 확장이 균형 있게 이루어지고, 방이 확장 가능한 상태가 유지된다.

#### **3.2.3 면적 요구 사항을 고려한 확장**

방 배치 과정에서 크기 제약을 준수하는 확장 방식은, 각 방이 사용자가 명시한 최대 면적을 초과하지 않도록 확장 범위를 제한하는 방법이다. 방의 크기 요구 사항은 각 방에 대해 최소 및 최대 허용 면적을 정의한 제약 조건으로 구성된다.

$$A_i^{\min} \leq A_i \leq A_i^{\max}$$

여기서 A_i는 방 i의 현재 면적이며, A_i^{\min}과 A_i^{\max}는 각각 방의 최소 및 최대 허용 면적을 나타낸다.

면적 요구 사항을 고려한 확장에서는 각 방이 확장될 때마다 자신의 면적을 추적하며, 방의 면적이 최대 허용 면적인 A_i^{\max}에 도달하면 더 이상 확장하지 않도록 제약을 적용한다. 이로 인해 확장이 완료된 방 주변에 방이 할당되지 않은 셀들로 구성된 빈 공간이 생성될 수 있다. 이러한 경우, 방을 할당받지 못한 셀들은 인접한 방들 중 하나의 방으로 할당된다. 인접 방의 선택은 임의로 이루어지며, 이를 통해 설계 공간 내의 모든 셀이 방에 할당될 수 있도록 한다.

따라서, 면적 요구 사항을 고려한 확장 방식은 각 방이 주어진 크기 제약을 준수하면서 공간을 효율적으로 채우고, 확장이 완료된 방 주변의 빈 공간을 최소화하는 역할을 기대할 수 있다.

---

### **3.3 돌출 셀 제거 알고리즘**

돌출 셀 제거 알고리즘은 시드 셀 확장으로 생성한 평면 배치 F에서 발생한 돌출 셀을 식별하고, 인접 방과 교환하는 방식이다. 그리드 기반의 방 배치 방식에서, 방 배치는 경계면을 따라 인접셀로 확장하는 방식으로 이루어지며, 임의적으로 선택된 방향에 따라 방의 형태가 결정된다. 그러나 병렬 확장 방식을 적용하더라도, 확장 셀 상호 간 충돌이 발생하면 **돌출 셀**이 생길 수 있다. 고립된 위치에 있는 이 작은 셀들은 방의 형태를 불규칙하게 만들며, 공간적 비효율성과 함께 평면도의 미적 일관성을 저해한다. 돌출 셀로 인해 생기는 설계의 미적 일관성과 효율성 저해를 개선하기 위해 돌출 셀을 제거하는 추가적인 절차를 도입하였다.

#### **3.3.1 돌출 셀 식별**

돌출 셀은 설계 공간 F의 모든 셀 c에 대해, 그 셀이 3개 이상의 유효하지 않은 셀 또는 다른 방에 속한 셀과 인접해 있다면 해당 셀을 돌출 셀로 간주한다.

$$P(c) = 
\begin{cases}
1, & \text{if } V(c) \text{ and } N_{\text{diff}}(c) \geq 3 \\
0, & \text{otherwise}
\end{cases}$$

여기서:
- P(c)는 셀 c가 돌출(protruding) 셀인지 여부를 나타내며, 1이면 돌출 셀이다.
- V(c)는 셀 c가 유효(valid)한지 여부를 나타내는 함수로, 셀이 설계 공간의 경계 내에 있고, 방 번호가 할당된 경우에 V(c) = 1이다.
- N_diff(c)는 셀 c의 인접한 셀 중 유효하지 않거나 다른 방에 속한 셀의 개수를 의미한다.

#### **3.3.2 교환 방 선택**

돌출 셀 교환은 돌출 셀을 인접한 다른 방으로 바꾸어 형태를 개선하는 과정이다. 방 교환이 가능하려면 다음 조건을 만족해야 한다.

1. **유효성 유지**: 교환 후에 변형된 방 배치는 개별 공간의 연결을 유지해야 하며, 빈 공간이 없어야 한다.
2. **교환 기록 추적**: 같은 위치의 교환이 반복해서 일어나지 않도록 교환 기록을 추적하여 교착 상태를 피해야 한다.

#### **3.3.3 돌출 셀 교환 알고리즘**

돌출 셀 교환 알고리즘은 돌출 셀 p_i를 인접한 다른 방 R_i로 교환하여 방의 형태를 개선하는 과정으로 다음 단계를 따른다.

1. **돌출 셀 선택**: 돌출 셀 집합 P에서 무작위로 하나의 셀을 선택한다.
$$p_i = \text{Random}(P)$$

2. **인접 방 후보 선택**: 선택된 돌출 셀 p_i에 인접한 셀들의 방 번호 집합 R(p_i)를 찾는다. 이는 돌출 셀 p_i와 이웃한 다른 방에 속한 셀들을 의미하며, 교환 가능한 후보 방을 추출하는 과정이다.
$$R(p_i) = \{R_j \mid R_j \in R(Adj(p_i)), \, R_j \neq R(p_i)\}$$

여기서:
- R(p_i)는 돌출 셀 p_i의 방 번호,
- Adj(p_i)는 돌출 셀 p_i에 인접한 셀의 좌표 집합,
- R(Adj(p_i))는 인접한 셀 방 번호 집합,
- R_j ≠ R(p_i)는 p_i와 인접한 방 중에서 다른 방을 선택하는 조건이다.

3. **최적 후보 방 선택**: 각 후보 방과의 교환 후 돌출 셀의 수를 평가하여, 돌출 셀 감소 효과가 가장 큰 방 R_j를 선택한다. 돌출 셀 변화는 다음과 같이 계산된다:
$$ \Delta P(p_i, R_j) = P_{old}(p_i, R_j) - P_{new}(p_i, R_j) $$

여기서:
- P_old(p_i, R_j)는 교환 이전에 돌출 셀 p_i와 이웃한 돌출 셀의 수,
- P_new(p_i, R_j)는 방 R_j로 교환한 후 발생한 돌출 셀 p_i의 수,
- ΔP(p_i, R_j)는 교환 전후의 돌출 셀 수 차이로, 이 값이 클수록 돌출 셀이 많이 감소하는 교환임을 나타낸다.

최종적으로 ΔP(p_i, R_j)를 계산한 후, 이 값이 가장 큰 방을 선택하여 교환을 진행한다.
$$ R_{\text{best}}(p_i) = \arg\max_{R_j \in R(p(p_i)} \Delta P(p_i, R_j) $$

4. **교환 기록 추적 및 반복**: 교환이 성공적으로 이루어지면, 교환된 셀과 방의 정보를 기록하여 교환 히스토리를 업데이트하고, 교환할 수 있는 새로운 후보 방을 탐색한다. 교환이 완료되면 해당 돌출 셀 p_i는 목록에서 제거된다.
$$P \leftarrow P \setminus \{p_i\}$$
이 과정을 반복하여 모든 돌출 셀이 제거될 때까지 알고리즘이 진행된다.

#### **3.3.4 알고리즘 결과**

돌출 셀 제거 알고리즘을 통해 평면도에서 돌출 셀이 제거되면, 방의 경계는 보다 매끄럽고 일관성 있는 형태로 정렬된다. 이를 통해 공간적 비효율성을 줄이고, 미적 일관성을 높인 평면도를 생성할 수 있다.