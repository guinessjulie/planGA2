본 연구에서는 설계의 초기 단계에서 각 방의 배치가 방향 요구사항을 충족할 수 있도록 최적화된 셀 배치 알고리즘을 제안한다. 이 과정은 방 배치의 첫 단계에서 **시드 셀**을 배치하고, 각 시드 셀에 요구사항에 맞는 방 번호를 할당함으로써 이후 확장될 방이 자연스럽게 요구된 방향을 충족하도록 유도하는 것을 목표로 한다.


### 3.1 초기 설계 단위 배치 방법

건축 평면을 생성하기 위한 설계 공간 \( G_{\text{footprint}} \)는 \( m \times n \) 크기의 격자 공간으로, 배치 공간(footprint)은 내부 공간을 정의하는 2차원 배열로 표현된다. 

평면도 생성은 이 설계공간내 모든 모든 유닛을 필요한 방의 갯수만큼 서로 다른 방으로 할당하는 것으로 정의한다. 이를 위해 개별 공간은 설계 공간의 특정 위치에서 시작하여 인접 셀로 확장한다. 이 때 초기 과정은 다음의 세 가지 주요 단계를 따른다:

**1. 각 방의 시작 위치 결정**:
먼저 설계 공간 $G_{footprint}$에서 공간의 개수 $k$ 만큼 무작위로 최소 단위의 격자 공간을 선택한다.  편의상 이 선택된 초기 위치를 시드 셀로 부르기로 한다.  

$$
s_i = (x, y) \quad \text{where} \quad G_{x,y} = 1 \quad \text{and} \quad i = 1, 2, \dots, k
$$
시드 셀 집합 $S$는 각 방의 시작 위치가 되며 아직 $s_i$는 방 번호가 할당되지 않았다. $s_i$ 에 미할당 플래그로 특정 값(255)을 할당한다. 

 **2. 방번호 할당:** 
 $k$ 개의 미할당 시드 셀에 고유한 방 번호를 할당한다.  
$$G_{\text{init}} = \{s_{i} \mid s_{i} \in \{1, 2, \ldots, k\}, i \in S \}\tag{2} $$
 시드 셀 집합 $S$의 각 요소 $s_i$는 서로 다른 방 번호를 가지며, 그리드의 나머지 부분은 아직 할당되지 않았다.   각 $s_i$의 위치는  공간 배치를 결정하는데 중요한 역할을 한다. 본 연구에서는 각 방의 초기 위치를 설정하는 방법으로 방향 최적화, 인접성 최적화, 그리고 임의 방 배정을 제시한다. 방향 최적화 및 인접성 최적화는 사용자 요구에 따라 선택적으로 적용할 수 있다. 방 번호가 할당되지 않은 시드 셀은  무작위로 배정된다. 

#### 3.1.1 방향 요구 최적화를 위한 시작 셀 할당

 방향 요구사항은 설계 요구사항에 의해 미리 결정된 것으로 각 방이 설계 공간 내에서 특정 방향으로 배치되어야 하는 조건을 나타낸다. 방들의 집합 $R = \{r_1, r_2, \dots, r_n\}$에서 각 방 $r_i$​는 특정 방향 $o_i$​ ($o∈\{동,서,남,북\}$) ​에 배치되도록 유도하고자 하는 것이 이 최적화의 목표이다.  **각 방의 방향 요구 사항 O**은 방 $r_i$​와 방향 $o_i$의 쌍으로 이루어진 집합 $O \subseteq R \times \{동, 서, 남, 북\}$으로 표현된다. 
$$O=\{(r_i​,o_i​) \mid r_i​ \in R,o_i​ \in \text{ \{East, West, South, North\} } ​\} $$

   방 $r_i$의 시드 셀 $s_i$가  요구 사항에 유리하도록 할당되려면, $s_i$의 위치가  방향 요구 사항 $O_i$​에서 지시하는 방향의 설계 공간 경계선과 가까운 거리에 있어야 할 것이다. 이를 위해 각 셀의 위치를 x과 y축으로 각각 정렬하여 이를 바탕으로 동, 서, 남, 북 네 방향에 대한 스코어 리스트 $Sc_o$를 생성한다. 각 방 $i$는 방향 요구 사항에 따라 스코어 리스트 $Sc_o$에서 가장 높은 순위에 있는 셀 $C_i$에 배정된다. 즉, $Sc_o(O_i)$는 방 $i$의 스코어 리스트 $Sc_o$에서 가장 높은 순위에 있는 셀 $s_i$에 배정된다. 

$$s_i​=\arg\max_{s_i}​Sc_o(O_i​) \tag{4}$$
#### 3.1.2 인접성 요구 최적화를 위한 시작 셀 할당


인접성 요구 $A$는 방들의 집합 $R = \{r_1, r_2, \dots, r_n\}$ 사이의 관계를 나타내는 이항 관계 $A⊆R×R$ 로 정의된다. 즉, 각 방의 인접성 요구는 방 $r_i$와 인접해야 하는  방 $r_j$의 인덱스 쌍  $(r_i, r_j)$ 의 집합으로 표현된다.
$$A = \{ (r_i, r_j) \mid r_i, r_j \in R,\text{ } r_i \text{ and } r_j \text{ must be adjacent} \} \tag{5}$$

$r_i$에  $r_j$와 인접 요구가 있는 경우, $s_i$에 대해  미할당 $s_j$ 중 가장 가까운 거리에 배치하는 것이 인접성 최적화 시드셀 배치 전략이다(식 6).

$$
s_i = \arg \min_{s_j \in \text{unassigned}} d_{i,j} \quad \text{where} \quad {(r_i, r_j) \in A} \tag{6}
$$
여기서 $d_{i,j}$는 방 $i$와 방 $j$ 간의 맨하탄 거리를 나타낸다. 맨해튼 거리는 두 점 간의 직교 좌표 상에서의 이동 거리를 계산하는 방식으로 식 (7)과 같다.
$$\text{Manhattan Distance} = |x_1 - x_2| + |y_1 - y_2|$$
아직 방 번호가 할당되지 않은 셀들 중에서 인접성 요구사항을 가장 잘 충족하는 위치에 방 번호가 할당된다. 추후 단계에서 시드 셀은 네 방향으로 확장하므로 가까운 거리에 있더라도 두 셀이 상반된 방향으로 확장하면서 그 사이를 다른 방이 배치된다면 두 방의 인접성은 깨어지므로 이러한 접근이 확률적으로 인접성 요구를 얼마나 만족시킬 수 있을지 불확실하다. 그러나 이 최적화는 두 시드셀이 가까울 수록 인접할 가능성은 커진다는 가정을 바탕으로 한다. 


#### 3.1.3  무작위 배치
방향과 인접성  요구 사항이 제시되지 않았거나 이 과정을 생략할 경우 모든 시드 셀은 무작위로 방번호를 할당받는다.  일부 방만 요구 사항이 제시되는 경우, 미할당 $s_i$은 할당되지 않은 나머지 방 번호에서 무작위로  할당받는다. 이를 통해 모든 시드 셀이 방 번호를 부여받고 초기 시드 셀의 배치가 완료된다. 


---
(손봐야함)
#### 5.3 결론

본 최적화 기법은 초기 설계 단계에서 각 방의 배치가 방향 요구사항과 인접성 요구사항을 충족할 수 있도록 유도하는 과정을 포함한다. 설계의 초기 단계에서부터 방향성과 인접성을 동시에 고려한 배치를 제공함으로써 공간 배치의 XXX을 높인다.