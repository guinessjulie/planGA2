### 4. 피트니스 함수와 사용자 정의 가중치 기반 설계 평가

본 연구는 다각형 기반의 공간 배치 문제를 해결하기 위해 세 가지 주요 요구사항(인접성, 면적, 방향성)을 종합적으로 평가하는 피트니스 함수를 제안한다. 이 함수는 사용자 정의 가중치 기반의 조화 평균을 통해 설계의 적합도를 정량적으로 측정하며, 각 요구사항에 대한 중요도는 사용자 설정에 따라 조정될 수 있다. 이를 통해 설계 목표에 맞춘 최적화된 공간 배치 평가가 가능해진다.

#### 4.1 세 가지 주요 요구사항의 적합도 계산

설계 평가의 핵심 요소는 인접성, 면적, 방향성의 적합도를 기반으로 이루어진다. 각 요구사항의 적합도는 독립적으로 평가되며, 세부 계산 방법은 다음과 같다.

##### 4.1.1 인접성 만족도 (Adjacency Satisfaction)

인접성 만족도는 요구된 방들 간의 인접 관계가 얼마나 충족되는지를 평가하는 지표이다. 이를 구하기 위해 두 방 $i$와 $j$에 대한 인접 요구사항 $R_{ij} \in \{0, 1\}$ (인접요구가 있는 경우  $R_{ij} = 1$,)과 실제 인접 관계  $A_{ij} \in \{0, 1\}$(실제로 인접한 경우 $A_{ij} = 1$로 )로 표현한다. 
이를 이용하여 만족된 인접 요구사항의 개수 $S_{\text{adj}}$​와 총 요구된 인접 요구사항의 개수 $T_{\text{adj}}$​는 다음과 같이 표현할 수 있다. 

$$
S_{\text{adj}} = \sum_{i,j} R_{ij} \cdot A_{ij}
$$
이 수식은 **모든 방 쌍 i,ji, ji,j** 에 대해 다음을 계산한다:

1. 두 방 i와 j 사이에 **인접 요구사항**이 있는지 확인한다 $R_{ij} = 1$
2. 두 방 i와 j가 실제로 **인접해 있는지** 확인한다 $A_{ij} = 1$
3. 두 값 $R_{ij}$​과 $A_{ij}$​를 곱한다. 이때:
    - $R_{ij} \cdot A_{ij} = 1$이면 요구된 인접성이 실제로 만족된 것이므로 **만족된 요구사항**으로 간주한다.
    - R_{ij} \cdot A_{ij} = 0$이면 요구된 인접성이 만족되지 않았거나, 요구 자체가 없음을 의미한다.
4. 이 계산을 모든 방 쌍 i,j에 대해 수행한 후, 이를 모두 더하여 **만족된 인접 요구사항의 총 개수**를 계산한다.

$$
T_{\text{adj}} = \sum_{i,j} R_{ij}
$$
따라서, 인접성 만족도 AS\text{AS}AS는 다음 수식으로 정의된다:

$$
\text{AS} =\frac{S_adj}{T+adj} = \frac{\sum_{i,j} R_{ij} \cdot A_{ij}}{\sum_{i,j} R_{ij}}
$$

##### 4.1.2 면적 만족도 (Size Satisfaction)

면적 만족도는 각 방의 면적이 주어진 최소 및 최대 요구사항을 얼마나 충족하는지 평가한다. 실제 면적이 요구 범위 내에 있을 때 적합도 점수는 1로 부여되며, 범위를 벗어날 경우 비례적으로 점수가 조정된다. 면적 만족도는 다음과 같이 계산된다:

- 면적이 요구 범위 내에 있을 때:
$$
\text{Score} = 1 \quad \text{if} \quad A_{\text{min}} \leq A_{\text{actual}} \leq A_{\text{max}}
$$
- 면적이 최소값보다 작을 때:
$$
\text{Score} = \frac{A_{\text{actual}}}{A_{\text{min}}} \quad \text{if} \quad A_{\text{actual}} < A_{\text{min}}
$$
- 면적이 최대값보다 클 때:
$$
\text{Score} = \frac{A_{\text{max}}}{A_{\text{actual}}} \quad \text{if} \quad A_{\text{actual}} > A_{\text{max}}
$$

최종 면적 만족도는 각 방의 적합도 점수의 평균으로 산출된다.

$$
\text{Size Satisfaction} = \frac{1}{n} \sum_{i=1}^{n} \text{Score}_i
$$

여기서 $n$은 평가된 방의 총 개수를 의미한다.

##### 4.1.3 방향성 만족도 (Orientation Satisfaction)

방향성 만족도는 각 방이 요구된 방향성(Orientation Requirements)을 충족하는지를 평가하는 지표이다. 요구된 방향이 실제 경계 방향과 일치할 경우 점수가 1로 부여되며, 이를 모든 방에 대해 계산한 후 평균을 구하여 최종 만족도를 산출한다.

$$
\text{Orientation Satisfaction} = \frac{1}{n} \sum_{i=1}^{n} \text{Score}_i
$$

여기서 $\text{Score}_i$는 $i$-번째 방의 적합도 점수이며, 요구된 방향과 실제 경계 방향이 일치할 경우 1, 그렇지 않으면 0이 부여된다.

#### 4.2 사용자 정의 가중치 기반 피트니스 계산

설계 평가에서 각 요구사항의 중요도는 프로젝트 특성에 따라 달라질 수 있다. 이를 반영하기 위해, 본 연구에서는 사용자 정의 가중치 기반의 피트니스 계산 방식을 도입하였다. 사용자는 **`config.ini`** 파일을 통해 각 요구사항의 가중치를 설정할 수 있으며, 이를 기반으로 최종 피트니스 점수가 계산된다.

피트니스 점수는 각 요구사항의 적합도를 가중 조화 평균을 사용하여 종합적으로 평가한다. 가중 조화 평균을 사용함으로써 특정 요구사항의 적합도가 낮을 경우 전체 피트니스 점수에 큰 영향을 미치게 된다. 피트니스 계산은 다음과 같은 수식으로 정의된다:

$$
\text{Total Fitness} = \frac{ adj\_w + ori\_w + size\_w }{ \frac{adj\_w}{adj} + \frac{ori\_w}{size} + \frac{size\_w}{ori} }
$$

여기서:
- $adj$는 인접성 만족도,
- $size$는 면적 만족도,
- $ori$는 방향성 만족도,
- $adj\_w$, $size\_w$, $ori\_w$는 각 요구사항에 대해 설정된 가중치이다.

#### 4.3 가중치 설정의 유연성 및 활용

사용자가 설정한 가중치에 따라 특정 요구사항이 전체 피트니스 점수에 미치는 영향을 조정할 수 있다. 예를 들어, 인접성의 중요도를 높게 설정하면 해당 요구사항의 만족도가 전체 점수에 더 큰 영향을 미치게 된다. 이를 통해 설계 목표에 맞춰 다양한 공간 배치 문제에 최적화된 평가를 수행할 수 있다.

결론적으로, 본 연구에서 제안한 피트니스 함수는 사용자의 설계 요구를 반영하여 인접성, 면적, 방향성의 적합도를 종합적으로 평가할 수 있으며, 이를 통해 설계의 최적화를 효율적으로 도출할 수 있는 유연한 도구를 제공한다.

---
아래 내용 위에 다시 씀
### 3.5 Fitness Score Calculation for Three Key Requirements

본 연구에서 다각형 기반의 공간 배치 문제 해결을 위해 세 가지 주요 요구사항을 평가하는 적합도 점수를 산출하였다. 각 요구사항은 인접성, 면적, 방향의 세 가지로 나뉘며, 각 요구사항에 대해 구체적인 적합도 점수 계산 방법을 아래에서 설명한다.

#### 3.5.1 Adjacency Satisfaction (인접성 만족도)

인접성 만족도는 방들 간의 요구된 인접성 요구사항을 얼마나 충족하는지 평가하는 지표이다. 주어진 인접 요구사항(adjacency requirements)에 따른 각 방의 실제 인접 관계를 비교하여 다음 방식으로 점수를 산출한다.

1. **인접 요구사항 추출:** 요구사항으로 정의된 방들 간의 인접성을 추출한다.
2. **실제 인접 리스트 생성:** BFS(너비 우선 탐색) 알고리즘을 통해 방의 실제 인접 리스트를 생성한다. 각 방의 셀을 기준으로 인접한 방을 탐색하여 리스트를 구축한다.
3. **만족도 계산:** 요구된 방들 간의 인접 관계가 실제로 만족될 경우 점수를 1점 부여하고, 이를 총 요구사항의 개수로 나누어 최종 만족도 점수를 계산한다.

인접성 만족도는 아래의 수식으로 나타낼 수 있다:

$$
\text{Adjacency Satisfaction} = \frac{\text{Number of Satisfied Adjacency Requirements}}{\text{Total Adjacency Requirements}}
$$

#### 3.5.2 Size Satisfaction (면적 만족도)

면적 만족도는 각 방이 주어진 최소 및 최대 면적 요구사항을 얼마나 충족하는지를 평가한다. 각 방의 실제 면적과 요구된 면적 범위를 비교하여 점수를 부여하며, 모든 방의 평균 점수를 최종 면적 만족도로 사용한다. 면적 만족도는 다음과 같은 방식으로 계산된다:

1. **셀 크기 변환:** 각 방의 면적은 mm² 단위로 측정되며, 이를 요구사항에 맞게 m² 단위로 변환한다. 셀의 크기는 config 파일을 참조하여 계산한다.
2. **면적 범위 평가:** 각 방의 실제 면적이 주어진 최소 및 최대 면적 범위 내에 있으면 1점을 부여한다. 만약 면적이 범위 밖에 있으면, 최소 면적 이하일 경우 면적에 비례하여 점수를 부여하고, 최대 면적 초과일 경우 반비례 점수를 부여한다.
3. **평균 점수 계산:** 모든 방에 대한 점수를 합산하고 방의 개수로 나누어 최종 만족도를 계산한다.
#### 면적 적합도 점수 계산

면적 적합도는 방의 실제 면적 $A_{\text{actual}}$이 주어진 최소 면적 $A_{\text{min}}$과 최대 면적 $A_{\text{max}}$ 사이에 위치하는지에 따라 다르게 산출된다.

1. **면적이 범위 내에 있을 경우**:
   실제 면적이 최소 면적과 최대 면적 범위 내에 존재하면 적합도 점수는 1로 부여된다.

   $$
   \text{Score} = 1 \quad \text{if} \quad A_{\text{min}} \leq A_{\text{actual}} \leq A_{\text{max}}
   $$

2. **면적이 최소 면적보다 작을 경우**:
   실제 면적이 최소 면적보다 작은 경우, 적합도 점수는 실제 면적이 최소 면적에 얼마나 근접했는지에 비례하여 계산되며, 다음과 같이 산출된다.

   $$
   \text{Score} = \frac{A_{\text{actual}}}{A_{\text{min}}} \quad \text{if} \quad A_{\text{actual}} < A_{\text{min}}
   $$

3. **면적이 최대 면적보다 클 경우**:
   실제 면적이 최대 면적을 초과할 경우, 적합도 점수는 최대 면적에 비례하여 감소하며 다음과 같이 계산된다.

   $$
   \text{Score} = \frac{A_{\text{max}}}{A_{\text{actual}}} \quad \text{if} \quad A_{\text{actual}} > A_{\text{max}}
   $$

최종 면적 적합도는 각 방의 적합도 점수의 평균으로 산출된다.

$$
\text{Size Satisfaction} = \frac{1}{n} \sum_{i=1}^{n} \text{Score}_i
$$

여기서 $n$은 평가된 방의 총 개수를 의미하며, $\text{Score}_i$는 각 방의 면적 적합도 점수이다.
#### 3.5.3 Orientation Satisfaction (방향성 만족도)

### 방향 만족도 계산 (Orientation Satisfaction)

방향 만족도는 각 방이 요구된 방향성(Orientation Requirements)을 얼마나 충족하는지 평가하는 지표이다. 각 방의 실제 경계 방향과 요구된 방향을 비교하여 점수를 부여하며, 모든 방의 평균 점수를 최종 방향 만족도로 산출한다. 방향 만족도는 방이 경계에 위치하는 방향을 기반으로 계산된다.

#### 경계 방향 계산

방의 실제 경계 방향은 방의 한 면이 요구되는 경계방향에 인접한지를  기반으로 산출된다. 경계 방향은 다음 네 가지 방향 중 하나로 정의된다: **북쪽(North)**, **남쪽(South)**, **동쪽(East)**, **서쪽(West)**.  경계 방향은 다음 방법으로 구한다. 

- 방의 구성 유닛 셀을 순회하며, 유닛의 경계면이 요구된 방향과 일치하는지의 여부를 확인한다. 

1. **요구된 방향이 실제 경계면의 방향 중 하나에 포함될 경우** 1점을 2. 포함되지 않을 경우 0점이 부여된다.
:
    $$
   \text{Score}_i = 1 \quad \text{if} \quad D_{\text{req}_i} \in D_{\text{actual}_i}
   $$
  $$
   \text{Score}_i = 0 \quad \text{if} \quad D_{\text{req}_i} \notin D_{\text{actual}_i}
   $$
	여기서 $D_{\text{req}_i}$는 $i$-번째 방의 요구된 방향, $D_{\text{actual}_i}$는 $i$-번째 방의 실제 경계 방향이다.

2. 방향 만족도는 모든 방에 대해 계산된 점수의 평균으로 산출된다. 즉, 요구된 방향을 충족한 방의 비율로 최종 만족도를 계산한다. 방향 요구사항이 없는 경우에는 만족도가 1로 간주된다.

$$
\text{Orientation Satisfaction} = \frac{1}{n} \sum_{i=1}^{n} \text{Score}_i
$$

여기서 $n$은 방향 요구사항이 있는 방의 개수이며, $\text{Score}_i$는 $i$-번째 방의 방향 적합도 점수이다.

이 세 가지 주요 요구사항(인접성, 면적, 방향성)에 대한 적합도는 각각 독립적으로 평가되며, 각 요구사항에 대한 만족도 점수를 통해 최종 설계의 적합성을 판단할 수 있다. 이를 통해 설계가 주어진 요구사항을 얼마나 충족하는지 객관적으로 평가할 수 있다.

### 3.6 사용자 정의 가중치 기반 적합도 계산

본 연구에서는 인접성, 면적, 방향성의 세 가지 요구사항을 고려하여 전반적인 적합도 점수를 산출한다. 각 요구사항의 중요도는 사용자가 설정할 수 있으며, 이는 **`config.ini`** 파일을 통해 정의된다. 이 방법은 요구사항에 따라 다양한 설계 우선순위를 반영할 수 있도록 유연성을 제공한다.

#### 3.6.1 가중치 설정

사용자는 설정 화면에서 각 요구사항의 가중치를 설정할 수 있도록 했다. 가중치는 인접성(Adjacency), 면적(Size), 방향성(Orientation)에 대해 독립적으로 설정되며, 이를 통해 특정 요구사항이 전체 적합도에 미치는 영향을 조정할 수 있다. 예를 들어, 다음과 같이 가중치를 설정할 수 있다:

```ini
[FitnessWeight]
adjacency = 2
orientation = 1
size = 1
```

이 설정에서 인접성 요구사항의 중요도를 2로 설정하여, 면적과 방향성 요구사항보다 더 큰 영향을 미치도록 한 이유는, 인접도 점수가 전체적으로 낮게 나오므로 그 비중을 높여 점수를 높이기 위함이다. 

#### 3.6.2 가중치 평균 점수 계산

적합도 점수는 사용자 정의 가중치를 반영하여 계산된다. 각 요구사항의 적합도(만족도)를 계산한 후, 이를 가중 조화 평균을 사용하여 종합 적합도 점수를 산출한다. 가중 조화 평균을 사용함으로써 특정 요구사항의 적합도가 낮을 경우, 그 값이 전체 적합도 점수에 크게 영향을 미치게 된다. 이 방식은 설계에서 모든 요구사항이 일정 수준 이상 만족되도록 유도한다.

적합도 계산은 다음과 같은 수식으로 정의된다:

$$
\text{Total Fitness} = \frac{ adj\_w + ori\_w + size\_w }{ \frac{adj\_w}{adj} + \frac{ori\_w}{size} + \frac{size\_w}{ori} }
$$

여기서:
- $adj$는 인접성 만족도,
- $size$는 면적 만족도,
- $ori$는 방향성 만족도,
- $adj\_w$, $size\_w$, $ori\_w$는 각 요구사항에 대해 설정된 가중치이다.

유연한 가중치 설정 방법을 통해 사용자는 각 프로젝트에  요구사항의 중요도를 반영하여 적합도 점수를 계산함으로써 다양한 설계 목표를 반영한 최적의 배치 결과를 도출할 수 있다.

### 3.4 Shape Fitness Metrics (Updated)

본 연구에서는 다각형의 형상 평가를 위해 네 가지 주요 적합도 메트릭을 사용하였다. 각 메트릭은 다각형의 기하학적 특성을 정량적으로 평가하는 기준으로 활용된다.

#### 3.4.1 Rectangularity (직사각형성)

직사각형성(Rectangularity)은 다각형의 면적(Area)과 바운딩 박스(Bounding Box, 이하 BB)의 면적 사이의 비율로 정의된다. 직사각형성은 다각형이 얼마나 직사각형에 가까운지를 평가하기 위한 지표로 사용되며, 다음 식으로 표현된다:

$$
R = \frac{A_{\text{polygon}}}{A_{\text{BB}}}
$$

여기서 $A_{\text{polygon}}$은 다각형의 면적을, $A_{\text{BB}}$는 해당 다각형을 포함하는 최소 바운딩 박스의 면적을 나타낸다. 바운딩 박스의 면적이 0일 경우에는 계산이 불가능하므로, 이때는 무한대(\(\infty\))로 처리한다.

#### 3.4.2 Regularity (정규성)

정규성(Regularity)은 다각형의 직사각형성과 바운딩 박스의 종횡비(Aspect Ratio)를 결합하여 다각형의 규칙성을 평가한다. 정규성은 다음과 같은 식으로 정의된다:

$$
Reg = R \times AR_{\text{BB}}
$$

여기서 $R$은 직사각형성, $AR_{\text{BB}}$는 바운딩 박스의 종횡비로, 종횡비는 바운딩 박스의 가로 길이와 세로 길이의 비율로 계산된다. 종횡비는 다음과 같이 정의된다:

$$
AR_{\text{BB}} = \frac{\text{width}_{\text{BB}}}{\text{height}_{\text{BB}}} \quad \text{if} \quad \text{height}_{\text{BB}} \geq \text{width}_{\text{BB}} \quad \text{else} \quad \frac{\text{height}_{\text{BB}}}{\text{width}_{\text{BB}}}
$$

#### 3.4.3 Perimeter-Area Ratio (둘레-면적 비율)

둘레-면적 비율(Perimeter-Area Ratio)은 다각형의 면적과 둘레의 비율을 통해 다각형의 압축성을 평가한다. 이는 다음과 같은 식으로 계산된다:

$$
PA_{\text{ratio}} = \frac{16 \times A_{\text{polygon}}}{P_{\text{polygon}}^2}
$$

여기서 $A_{\text{polygon}}$은 다각형의 면적을, $P_{\text{polygon}}$은 다각형의 둘레 길이를 나타낸다.

#### 3.4.4 Simplicity (단순성)

단순성(Simplicity)은 다각형의 꼭짓점 개수를 기반으로 계산되며, 다각형이 얼마나 단순한지(즉, 얼마나 적은 꼭짓점을 가지고 있는지)를 평가하는 지표이다. 단순성은 다음과 같이 정의된다:

$$
S = \frac{4}{V}
\quad \text{if} \quad V \geq 4 \quad \text{else} \quad 1.0
$$

여기서 $V$는 다각형의 꼭짓점 개수를 나타낸다. 꼭짓점의 개수가 4개 미만일 경우 다각형은 단순하다고 가정하여 단순성 값은 1.0으로 설정된다.

#### 3.4.5 면적 계산

다각형의 면적은 각 꼭짓점 좌표를 기반으로 아래의 식을 사용하여 계산된다:

$$
A_{\text{polygon}} = \frac{1}{2} \left| \sum_{i=1}^{n} \left( x_i y_{i-1} - y_i x_{i-1} \right) \right|
$$

여기서 $(x_i, y_i)$는 각 꼭짓점의 좌표이며, $n$은 꼭짓점의 개수이다.

#### 3.4.6 둘레 길이 계산

다각형의 둘레는 각 꼭짓점 간의 유클리드 거리(Euclidean Distance)를 합산하여 계산된다. 각 꼭짓점 간 거리는 다음 식을 통해 계산된다:

$$
P_{\text{polygon}} = \sum_{i=1}^{n} \sqrt{(x_{i+1} - x_i)^2 + (y_{i+1} - y_i)^2}
$$

여기서 $(x_i, y_i)$는 $i$-번째 꼭짓점의 좌표이고, $(x_{i+1}, y_{i+1})$는 다음 꼭짓점의 좌표를 의미한다.


---
